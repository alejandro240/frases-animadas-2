services:
  # SERVICIO APP: PHP-FPM con código de Laravel
  app:
    image: alejandro240/frases-animadas:latest  # Imagen desde Docker Hub (construida por GitHub Actions)
    container_name: frases_app
    working_dir: /var/www/html
    environment:
      APP_ENV: production
      APP_DEBUG: "false"
      APP_URL: http://localhost
    volumes:
      # Volumen compartido: permite a Nginx acceder a archivos estáticos (CSS/JS)
      - app_data:/var/www/html
    expose:
      - "9000"  # Puerto interno para comunicación con Nginx

  # SERVICIO WEB: Nginx como servidor web y proxy a PHP-FPM
  web:
    image: nginx:alpine
    container_name: frases_web
    ports:
      - "80:80"  # Puerto expuesto: http://217.154.6.94:80
    volumes:
      # Acceso READ-ONLY a archivos estáticos desde el volumen compartido
      - app_data:/var/www/html:ro
      # Configuración de Nginx (archivo local del servidor)
      - ./default.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - app  # Nginx necesita que PHP-FPM esté corriendo

# VOLUMEN: Compartido entre app y web para servir archivos estáticos
volumes:
  app_data:
